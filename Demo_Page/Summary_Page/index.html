<style>
    .footer a[href*="github.com"] {
        display: none;
    }
</style><!DOCTYPE html>
<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="styles.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Summarization Page</title>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <a href="#">Praxim.ai</a>
            </div>
            <nav class="navigation">
                <a href="#" onclick="logOut()">Log Out</a>
            </nav>
        </div>
    </header>
    <main id="main-content">
        <div id="sidebar">
            <button id="upload-button">Upload Document</button>
            <ul id="document-list"></ul>
        </div>
        <div id="left-div">
            <h1>Original Documents</h1>
            <p>"placeholder for original documents"</p>
        </div>
        <div id="sidebar">
            <button id="generate-button">Generated Document</button>
            <ul id="generate-list"></ul>
        </div>        
        <div id="right-div">
          <h1>Generated Summarization</h1>
          <p>"placeholder for generated summarization"</p>
        </div>
    </main>
    <script src="https://www.gstatic.com/firebasejs/9.x/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x/firebase-firestore.js"></script>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
      
        const firebaseConfig = {
          apiKey: "AIzaSyBZvsBcAoIJLbQc4yINQz78oyCovB4RDTA",
          authDomain: "praximai-438817.firebaseapp.com",
          projectId: "praximai-438817",
          storageBucket: "praximai-438817.appspot.com",
          messagingSenderId: "274586621759",
          appId: "1:274586621759:web:b9f20b3da3329327eba58a",
          measurementId: "G-EQ7HTDC8T3"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        firebase.initializeApp(firebaseConfig);
        const storage = firebase.storage();
        const db = firebase.firestore();

        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = "../";
            }
        });

        window.logOut = function() {
            signOut(auth).then(() => {
                window.location.href = "../";
            }).catch((error) => {
                console.error("Error during logout", error);
            });
        };

        function uploadFile(userId) {
            const file = document.getElementById('fileInput').files[0];
            if (file) {
                const storageRef = storage.ref(`documents/${userId}/${file.name}`);
                storageRef.put(file)
                    .then(snapshot => snapshot.ref.getDownloadURL())
                    .then(downloadURL => {
                        return db.collection('users').doc(userId).collection('documents').add({
                            name: file.name,
                            url: downloadURL,
                            uploadedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    })
                    .then(() => {
                        loadUserDocuments(userId);
                    })
                    .catch(error => {
                        console.error("Error uploading document: ", error);
                    });
            } else {
                alert("Please select a file to upload.");
            }
        }
        
        function loadUserDocuments(userId) {
            const documentList = document.getElementById('document-list');
            documentList.innerHTML = ''; // Clear current list

            db.collection('users').doc(userId).collection('documents')
                .orderBy('uploadedAt', 'desc')
                .get()
                .then(querySnapshot => {
                    querySnapshot.forEach(doc => {
                        const li = document.createElement('li');
                        const data = doc.data();

                        li.textContent = data.name;
                        li.addEventListener('click', () => {
                            window.open(data.url, '_blank'); // Open document in a new tab
                        });

                        documentList.appendChild(li);
                    });
                })
                .catch(error => {
                    console.error("Error fetching document list: ", error);
                });
        }
        document.getElementById('upload-button').addEventListener('click', () => {
            const user = firebase.auth().currentUser;
            if (user) {
                uploadFile(user.uid);
            } else {
                alert("No user logged in. Please log in first.");
            }
        });
    </script>
</body>
</html>
