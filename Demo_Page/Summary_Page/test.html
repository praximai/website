<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Storage Upload</title>
    <!-- Add Firebase libraries -->
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-firestore.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #sidebar {
            width: 300px;
            border-right: 1px solid #ccc;
            padding: 20px;
        }
        #content {
            margin-left: 320px;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div id="sidebar">
        <h2>Uploaded Documents</h2>
        <ul id="document-list"></ul>
    </div>
    <div id="content">
        <h2>Upload Document</h2>
        <input type="file" id="fileInput" />
        <button onclick="uploadFile()">Upload</button>
    </div>

    <script type="module">
        import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

const db = getFirestore(app);

import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-storage.js";
import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

const storage = getStorage(app);
const db = getFirestore(app);

// Function to upload a document
async function uploadDocument(event) {
    event.preventDefault();

    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = 'application/pdf, application/msword, text/plain';
    fileInput.onchange = async (e) => {
        const file = e.target.files[0];
        if (file) {
            try {
                // Create a storage reference
                const storageRef = ref(storage, `documents/${file.name}`);
                // Upload file
                const uploadTask = uploadBytesResumable(storageRef, file);

                // Listen for upload completion to get the download URL
                uploadTask.on('state_changed', 
                    (snapshot) => {
                        // Optional: You can add progress feedback here
                    }, 
                    (error) => {
                        console.error("Error during file upload:", error);
                    }, 
                    async () => {
                        // Upload finished successfully, now get the download URL
                        const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
                        // Store file metadata and URL in Firestore
                        await addDoc(collection(db, "documents"), {
                            name: file.name,
                            url: downloadURL,
                            created: Date.now()
                        });
                    }
                );
            } catch (error) {
                console.error("Error uploading document:", error);
            }
        }
    };

    fileInput.click();
}

// Set up a real-time listener to load documents
function loadDocuments() {
    const documentList = document.getElementById('document-list');
    onSnapshot(collection(db, "documents"), (snapshot) => {
        documentList.innerHTML = ''; // Clear the list before repopulating
        snapshot.forEach((doc) => {
            const li = document.createElement('li');
            li.textContent = doc.data().name;
            li.onclick = () => {
                // Open the document URL in a new tab
                window.open(doc.data().url, '_blank');
            };
            documentList.appendChild(li);
        });
    }, (error) => {
        console.error("Error loading documents:", error);
    });
}

// Initialize real-time document loading
loadDocuments();

document.getElementById('upload-button').addEventListener('click', uploadDocument);





    </script>
</body>
</html>